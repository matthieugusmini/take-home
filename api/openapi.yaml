openapi: 3.0.3
info:
  title: Riot Take-Home Technical Challenge API
  version: 1.0.0
  description: |
    HTTP API that exposes encoding (base64 at depth 1), decoding, signing (HMAC), and verification.

    **Note:** Base64 here is used as specified in the challenge (encoding, not true encryption).
    Signing is performed against a canonicalized JSON representation so that key order does not affect the signature.

servers:
  - url: http://localhost:8080/v1

tags:
  - name: crypto
    description: Encode/decode operations (depth-1)
  - name: signature
    description: HMAC signature operations

paths:
  /encrypt:
    post:
      tags: [crypto]
      summary: Base64-encode all depth-1 values of the JSON object
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AnyObject'
            examples:
              sample:
                value:
                  name: John Doe
                  age: 30
                  contact:
                    email: john@example.com
                    phone: "123-456-7890"
      responses:
        '200':
          description: Object with depth-1 values encoded as base64 strings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EncryptResponse'
              examples:
                sample:
                  value:
                    name: Sm9obiBEb2U=
                    age: MzA=
                    contact: eyJlbWFpbCI6ImpvaG5AZXhhbXBsZS5jb20iLCJwaG9uZSI6IjEyMy00NTYtNzg5MCJ9
        '400':
          description: Invalid JSON
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /decrypt:
    post:
      tags: [crypto]
      summary: Base64-decode depth-1 string values (if decodable) back to their original JSON values
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AnyObject'
            examples:
              sample:
                value:
                  name: Sm9obiBEb2U=
                  age: MzA=
                  contact: eyJlbWFpbCI6ImpvaG5AZXhhbXBsZS5jb20iLCJwaG9uZSI6IjEyMy00NTYtNzg5MCJ9
              mixed:
                value:
                  name: Sm9obiBEb2U=
                  age: MzA=
                  contact: eyJlbWFpbCI6ImpvaG5AZXhhbXBsZS5jb20iLCJwaG9uZSI6IjEyMy00NTYtNzg5MCJ9
                  birth_date: "1998-11-19"
      responses:
        '200':
          description: Original JSON object reconstructed (when decodable), others unchanged
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnyObject'
              examples:
                sample:
                  value:
                    name: John Doe
                    age: 30
                    contact:
                      email: john@example.com
                      phone: "123-456-7890"
                mixed:
                  value:
                    name: John Doe
                    age: 30
                    contact:
                      email: john@example.com
                      phone: "123-456-7890"
                    birth_date: "1998-11-19"
        '400':
          description: Invalid JSON
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /sign:
    post:
      tags: [signature]
      summary: Create an HMAC signature for the JSON object (order-independent)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AnyObject'
            examples:
              sample:
                value:
                  message: Hello World
                  timestamp: 1616161616
              orderVariant:
                value:
                  timestamp: 1616161616
                  message: Hello World
      responses:
        '200':
          description: Signature created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignResponse'
              examples:
                sample:
                  value:
                    signature: a1b2c3d4e5f6g7h8i9j0deadbeefcafebabefeed0123456789abcdef
        '400':
          description: Invalid JSON
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /verify:
    post:
      tags: [signature]
      summary: Verify an HMAC signature against the provided JSON object
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyRequest'
            examples:
              valid:
                value:
                  signature: a1b2c3d4e5f6g7h8i9j0deadbeefcafebabefeed0123456789abcdef
                  data:
                    message: Hello World
                    timestamp: 1616161616
              validOrderVariant:
                value:
                  signature: a1b2c3d4e5f6g7h8i9j0deadbeefcafebabefeed0123456789abcdef
                  data:
                    timestamp: 1616161616
                    message: Hello World
              invalid:
                value:
                  signature: a1b2c3d4e5f6g7h8i9j0deadbeefcafebabefeed0123456789abcdef
                  data:
                    message: Goodbye World
                    timestamp: 1616161616
      responses:
        '204':
          description: Signature is valid (no content)
        '400':
          description: Invalid signature or invalid request payload

components:
  schemas:
    AnyObject:
      description: Any JSON object
      type: object
      additionalProperties: true

    EncryptResponse:
      description: Object with same keys as input, all depth-1 values encoded as base64 strings
      type: object
      additionalProperties:
        type: string

    SignResponse:
      type: object
      properties:
        signature:
          type: string
          description: HMAC-SHA256 signature encoded as lowercase hex
      required: [signature]
      additionalProperties: false

    VerifyRequest:
      type: object
      properties:
        signature:
          type: string
          description: HMAC-SHA256 signature (lowercase hex)
        data:
          $ref: '#/components/schemas/AnyObject'
      required: [signature, data]
      additionalProperties: false

    Error:
      type: object
      properties:
        error:
          type: string
      required: [error]
      additionalProperties: false
